
Perfect! Below is everything you need to:


---

âœ… 1. Liquibase Changelog File (XML format)

Save this as:
ðŸ“„ src/main/resources/db/changelog/changeset-create-api-transaction-log.xml

<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
          http://www.liquibase.org/xml/ns/dbchangelog
          http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

    <changeSet id="create-api-transaction-log" author="manish">
        <createTable tableName="api_transaction_log">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="ifsc_code" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="account_number" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="request_time" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="response_payload" type="TEXT"/>
            <column name="response_status" type="VARCHAR(50)"/>
            <column name="response_time" type="TIMESTAMP"/>
            <column name="error_message" type="TEXT"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>

        <createIndex tableName="api_transaction_log" indexName="idx_ifsc_account">
            <column name="ifsc_code"/>
            <column name="account_number"/>
        </createIndex>

        <createIndex tableName="api_transaction_log" indexName="idx_response_status">
            <column name="response_status"/>
        </createIndex>
    </changeSet>
</databaseChangeLog>


---

âœ… 2. Master Changelog File

If you're using a master changelog, add this file to it:

ðŸ“„ src/main/resources/db/changelog/db.changelog-master.xml

<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

    <include file="db/changelog/changeset-create-api-transaction-log.xml"/>
</databaseChangeLog>


---

âœ… 3. application.yml Configuration for Liquibase + Postgres

spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/your_db
    username: your_user
    password: your_password
    driver-class-name: org.postgresql.Driver

  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.xml

  jpa:
    hibernate:
      ddl-auto: none  # Liquibase manages schema
    show-sql: true
    properties:
      hibernate:
        format_sql: true


---

ðŸ§ª To Verify:

Run your app, and Liquibase will automatically create the table and indexes.

> âœ… Make sure PostgreSQL is running and accessible
âœ… Schema should be empty or handle changelog history via DATABASECHANGELOG and DATABASECHANGELOGLOCK




---





@Entity
@Table(name = "api_transaction_log")
public class ApiTransactionLog {

    @Id
    @Column(columnDefinition = "UUID")
    private UUID id;

    private String ifscCode;

    private String accountNumber;

    private LocalDateTime requestTime;

    @Lob
    private String responsePayload;

    private String responseStatus;

    private LocalDateTime responseTime;

    @Lob
    private String errorMessage;

    private LocalDateTime createdAt;

    private LocalDateTime updatedAt;

    // Getters, setters, constructors omitted for brevity
}



Certainly! Here's a visual representation of the api_transaction_log table with sample data for both a successful case and a failure case:


---

ðŸ“Š Table: api_transaction_log

id (UUID)	ifsc_code	account_number	request_time	response_payload	response_status	response_time	error_message	created_at	updated_at

d1a3...c8e7	ABC0001234	1234567890	2025-06-23 10:05:12	{"accountHolderName":"John Doe"}	SUCCESS	2025-06-23 10:05:13	NULL	2025-06-23 10:05:12	2025-06-23 10:05:13
f9b2...b7ad	ABC0001234	9999999999	2025-06-23 10:06:48	NULL	FAILED	2025-06-23 10:06:48	Account not found or closed	2025-06-23 10:06:48	2025-06-23 10:06:48



---

ðŸ§  Explanation:

âœ… Both rows use a unique UUID as a primary key.

ðŸŸ¢ First row shows a successful response: John Doe was returned.

ðŸ”´ Second row shows a failure: the account doesnâ€™t exist, and the error is logged in error_message.

ðŸ•“ request_time and response_time track the full request duration.



---

Would you like this rendered as a styled HTML table (e.g., for reporting or admin portal)?



@Service
public class AccountLookupService {

    @Autowired
    private ApiTransactionLogRepository repository;

    public String lookupAccount(String ifsc, String accountNumber) {
        UUID txnId = UUID.randomUUID();
        LocalDateTime now = LocalDateTime.now();

        // Step 1: Log the request
        logTransaction(txnId, ifsc, accountNumber, now, null, null, null);

        String accountHolderName = null;
        String status = null;
        String error = null;
        String responsePayload = null;

        try {
            // Simulated business logic
            if ("1234567890".equals(accountNumber) && "ABC0001234".equalsIgnoreCase(ifsc)) {
                accountHolderName = "John Doe";
                status = "SUCCESS";
                responsePayload = "{\"accountHolderName\":\"" + accountHolderName + "\"}";
            } else {
                status = "FAILED";
                error = "Account not found or closed";
            }

            // Step 2: Log the response
            logTransaction(txnId, null, null, null, status, responsePayload, error);

            return accountHolderName != null ? accountHolderName : error;

        } catch (Exception ex) {
            // Step 3: Log unexpected error
            logTransaction(txnId, null, null, null, "ERROR", null, "Unexpected error: " + ex.getMessage());
            return "Internal Error Occurred";
        }
    }

    private void logTransaction(UUID id,
                                String ifsc,
                                String accountNumber,
                                LocalDateTime requestTime,
                                String responseStatus,
                                String responsePayload,
                                String errorMessage) {

        Optional<ApiTransactionLog> optionalLog = repository.findById(id);
        ApiTransactionLog log = optionalLog.orElse(new ApiTransactionLog());
        LocalDateTime now = LocalDateTime.now();

        log.setId(id);
        if (ifsc != null) log.setIfscCode(ifsc);
        if (accountNumber != null) log.setAccountNumber(accountNumber);
        if (requestTime != null) log.setRequestTime(requestTime);
        if (log.getCreatedAt() == null) log.setCreatedAt(now);

        if (responseStatus != null) {
            log.setResponseStatus(responseStatus);
            log.setResponseTime(now);
        }
        if (responsePayload != null) log.setResponsePayload(responsePayload);
        if (errorMessage != null) log.setErrorMessage(errorMessage);

        log.setUpdatedAt(now);
        repository.save(log);
    }
}